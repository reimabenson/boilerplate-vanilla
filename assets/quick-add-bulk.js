"use strict";if(!customElements.get("quick-add-bulk"))customElements.define("quick-add-bulk",class QuickAddBulk extends BulkAdd{constructor(){super();this.quantity=this.querySelector("quantity-input");const t=debounce((t=>{if(parseInt(t.target.value)===0)this.startQueue(t.target.dataset.index,parseInt(t.target.value));else this.validateQuantity(t)}),ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",t.bind(this));this.listenForActiveInput();this.listenForKeydown();this.lastActiveInputId=null}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,(t=>{if(t.source==="quick-add"||t.cartData.items&&!t.cartData.items.some((t=>t.id===parseInt(this.dataset.index)))||t.cartData.variant_id&&!(t.cartData.variant_id===parseInt(this.dataset.index)))return;this.onCartUpdate().then((()=>{this.listenForActiveInput();this.listenForKeydown()}))}))}disconnectedCallback(){if(this.cartUpdateUnsubscriber)this.cartUpdateUnsubscriber()}get input(){return this.querySelector("quantity-input input")}selectProgressBar(){return this.querySelector(".progress-bar-container")}listenForActiveInput(){var t;if(!this.classList.contains("hidden"))(t=this.input)==null?void 0:t.addEventListener("focusin",(t=>t.target.select()));this.isEnterPressed=false}listenForKeydown(){var t;(t=this.input)==null?void 0:t.addEventListener("keydown",(t=>{var e;if(t.key==="Enter"){(e=this.input)==null?void 0:e.blur();this.isEnterPressed=true}}))}cleanErrorMessageOnType(t){t.target.addEventListener("keypress",(()=>{t.target.setCustomValidity("")}),{once:true})}get sectionId(){if(!this._sectionId)this._sectionId=this.closest(".collection-quick-add-bulk").dataset.id;return this._sectionId}onCartUpdate(){return new Promise(((t,e)=>{fetch(`${this.getSectionsUrl()}?section_id=${this.sectionId}`).then((t=>t.text())).then((e=>{const s=(new DOMParser).parseFromString(e,"text/html");const i=s.querySelector(`#quick-add-bulk-${this.dataset.index}-${this.sectionId}`);if(i)this.innerHTML=i.innerHTML;t()})).catch((t=>{console.error(t);e(t)}))}))}getSectionsUrl(){const t=new URLSearchParams(window.location.search);const e=decodeURIComponent(t.get("page")||"");return`${window.location.pathname}${e?`?page=${e}`:""}`}updateMultipleQty(t){this.selectProgressBar().classList.remove("hidden");const e=Object.keys(t);const s=JSON.stringify({updates:t,sections:this.getSectionsToRender().map((t=>t.section)),sections_url:this.getSectionsUrl()});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:s}).then((t=>t.text())).then((t=>{const s=JSON.parse(t);this.renderSections(s,e);publish(PUB_SUB_EVENTS.cartUpdate,{source:"quick-add",cartData:s})})).catch((()=>{})).finally((()=>{this.selectProgressBar().classList.add("hidden");this.setRequestStarted(false)}))}getSectionsToRender(){return[{id:`quick-add-bulk-${this.dataset.index}-${this.sectionId}`,section:this.sectionId,selector:`#quick-add-bulk-${this.dataset.index}-${this.sectionId}`},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"CartDrawer",selector:".drawer__inner",section:"cart-drawer"}]}renderSections(t,e){const s=this.queue.filter((t=>e.includes(t.id)));if(s.length!==0)return;this.getSectionsToRender().forEach((e=>{var s;const i=document.getElementById(e.id);if(e.section==="cart-drawer")(s=i.closest("cart-drawer"))==null?void 0:s.classList.toggle("is-empty",t.items.length.length===0);const n=i&&i.querySelector(e.selector)?i.querySelector(e.selector):i;if(n)n.innerHTML=this.getSectionInnerHTML(t.sections[e.section],e.selector)}));if(this.isEnterPressed)this.querySelector(`#Quantity-${this.lastActiveInputId}`).select();this.listenForActiveInput();this.listenForKeydown()}});
