"use strict";if(!customElements.get("localization-form"))customElements.define("localization-form",class LocalizationForm extends HTMLElement{constructor(){super();this.mql=window.matchMedia("(min-width: 750px)");this.header=document.querySelector(".header-wrapper");this.elements={input:this.querySelector('input[name="locale_code"], input[name="country_code"]'),button:this.querySelector("button.localization-form__select"),panel:this.querySelector(".disclosure__list-wrapper"),search:this.querySelector('input[name="country_filter"]'),closeButton:this.querySelector(".country-selector__close-button"),resetButton:this.querySelector(".country-filter__reset-button"),searchIcon:this.querySelector(".country-filter__search-icon"),liveRegion:this.querySelector("#sr-country-search-results")};this.addEventListener("keyup",this.onContainerKeyUp.bind(this));this.addEventListener("keydown",this.onContainerKeyDown.bind(this));this.addEventListener("focusout",this.closeSelector.bind(this));this.elements.button.addEventListener("click",this.openSelector.bind(this));if(this.elements.search){this.elements.search.addEventListener("keyup",this.filterCountries.bind(this));this.elements.search.addEventListener("focus",this.onSearchFocus.bind(this));this.elements.search.addEventListener("blur",this.onSearchBlur.bind(this));this.elements.search.addEventListener("keydown",this.onSearchKeyDown.bind(this))}if(this.elements.closeButton)this.elements.closeButton.addEventListener("click",this.hidePanel.bind(this));if(this.elements.resetButton){this.elements.resetButton.addEventListener("click",this.resetFilter.bind(this));this.elements.resetButton.addEventListener("mousedown",(e=>e.preventDefault()))}this.querySelectorAll("a").forEach((e=>e.addEventListener("click",this.onItemClick.bind(this))))}hidePanel(){this.elements.button.setAttribute("aria-expanded","false");this.elements.panel.setAttribute("hidden",true);if(this.elements.search){this.elements.search.value="";this.filterCountries();this.elements.search.setAttribute("aria-activedescendant","")}document.body.classList.remove("overflow-hidden-mobile");document.querySelector(".menu-drawer").classList.remove("country-selector-open");this.header.preventHide=false}onContainerKeyDown(e){const t=Array.from(this.querySelectorAll("a")).filter((e=>!e.parentElement.classList.contains("hidden")));let s=t.findIndex((e=>e===document.activeElement));let i;switch(e.code.toUpperCase()){case"ARROWUP":e.preventDefault();i=s>0?t[s-1]:t[t.length-1];i.focus();break;case"ARROWDOWN":e.preventDefault();i=s<t.length-1?t[s+1]:t[0];i.focus();break}if(!this.elements.search)return;setTimeout((()=>{s=t.findIndex((e=>e===document.activeElement));if(s>-1)this.elements.search.setAttribute("aria-activedescendant",t[s].id);else this.elements.search.setAttribute("aria-activedescendant","")}))}onContainerKeyUp(e){e.preventDefault();switch(e.code.toUpperCase()){case"ESCAPE":if(this.elements.button.getAttribute("aria-expanded")=="false")return;this.hidePanel();e.stopPropagation();this.elements.button.focus();break;case"SPACE":if(this.elements.button.getAttribute("aria-expanded")=="true")return;this.openSelector();break}}onItemClick(e){e.preventDefault();const t=this.querySelector("form");this.elements.input.value=e.currentTarget.dataset.value;if(t)t.submit()}openSelector(){this.elements.button.focus();this.elements.panel.toggleAttribute("hidden");this.elements.button.setAttribute("aria-expanded",(this.elements.button.getAttribute("aria-expanded")==="false").toString());if(!document.body.classList.contains("overflow-hidden-tablet"))document.body.classList.add("overflow-hidden-mobile");if(this.elements.search&&this.mql.matches)this.elements.search.focus();if(this.hasAttribute("data-prevent-hide"))this.header.preventHide=true;document.querySelector(".menu-drawer").classList.add("country-selector-open")}closeSelector(e){if(e.target.classList.contains("country-selector__overlay")||!this.contains(e.target)||!this.contains(e.relatedTarget))this.hidePanel()}normalizeString(e){return e.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase()}filterCountries(){const e=this.normalizeString(this.elements.search.value);const t=this.querySelector(".popular-countries");const s=this.querySelectorAll("a");let i=s.length;this.elements.resetButton.classList.toggle("hidden",!e);if(t)t.classList.toggle("hidden",e);s.forEach((t=>{const s=this.normalizeString(t.querySelector(".country").textContent);if(s.indexOf(e)>-1){t.parentElement.classList.remove("hidden");i++}else{t.parentElement.classList.add("hidden");i--}}));if(this.elements.liveRegion)this.elements.liveRegion.innerHTML=window.accessibilityStrings.countrySelectorSearchCount.replace("[count]",i);this.querySelector(".country-selector").scrollTop=0;this.querySelector(".country-selector__list").scrollTop=0}resetFilter(e){e.stopPropagation();this.elements.search.value="";this.filterCountries();this.elements.search.focus()}onSearchFocus(){this.elements.searchIcon.classList.add("country-filter__search-icon--hidden")}onSearchBlur(){if(!this.elements.search.value)this.elements.searchIcon.classList.remove("country-filter__search-icon--hidden")}onSearchKeyDown(e){if(e.code.toUpperCase()==="ENTER")e.preventDefault()}});
