"use strict";var __defProp=Object.defineProperty;var __defNormalProp=(t,e,i)=>e in t?__defProp(t,e,{enumerable:true,configurable:true,writable:true,value:i}):t[e]=i;var __publicField=(t,e,i)=>__defNormalProp(t,typeof e!=="symbol"?e+"":e,i);if(!customElements.get("price-per-item"))customElements.define("price-per-item",class PricePerItem extends HTMLElement{constructor(){super();__publicField(this,"updatePricePerItemUnsubscriber");__publicField(this,"variantIdChangedUnsubscriber");this.variantId=this.dataset.variantId;this.input=document.getElementById(`Quantity-${this.dataset.sectionId||this.dataset.variantId}`);if(this.input)this.input.addEventListener("change",this.onInputChange.bind(this));this.getVolumePricingArray()}connectedCallback(){this.variantIdChangedUnsubscriber=subscribe(PUB_SUB_EVENTS.variantChange,(t=>{this.variantId=t.data.variant.id.toString();this.getVolumePricingArray()}));this.updatePricePerItemUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,(t=>{if(!t.cartData)return;if(t.cartData["variant_id"]!==void 0){if(t.productVariantId===this.variantId)this.updatePricePerItem(t.cartData.quantity)}else if(t.cartData.item_count!==0){const e=t.cartData.items.find((t=>t.variant_id.toString()===this.variantId));if(e&&e.id.toString()===this.variantId)this.updatePricePerItem(e.quantity);else this.updatePricePerItem(0)}else this.updatePricePerItem(0)}))}disconnectedCallback(){if(this.updatePricePerItemUnsubscriber)this.updatePricePerItemUnsubscriber();if(this.variantIdChangedUnsubscriber)this.variantIdChangedUnsubscriber()}onInputChange(){this.updatePricePerItem()}updatePricePerItem(t){if(this.input){this.enteredQty=parseInt(this.input.value);this.step=parseInt(this.input.step)}this.currentQtyForVolumePricing=t===void 0?this.getCartQuantity(t)+this.enteredQty:this.getCartQuantity(t)+parseInt(this.step);if(this.classList.contains("variant-item__price-per-item"))this.currentQtyForVolumePricing=this.getCartQuantity(t);for(let e of this.qtyPricePairs)if(this.currentQtyForVolumePricing>=e[0]){const t=document.querySelector(`price-per-item[id^="Price-Per-Item-${this.dataset.sectionId||this.dataset.variantId}"] .price-per-item span`);this.classList.contains("variant-item__price-per-item")?t.innerHTML=window.quickOrderListStrings.each.replace("[money]",e[1]):t.innerHTML=e[1];break}}getCartQuantity(t){return t||t===0?t:parseInt(this.input.dataset.cartQuantity)}getVolumePricingArray(){const t=document.getElementById(`Volume-${this.dataset.sectionId||this.dataset.variantId}`);this.qtyPricePairs=[];if(t)t.querySelectorAll("li").forEach((t=>{const e=parseInt(t.querySelector("span:first-child").textContent);const i=t.querySelector("span:not(:first-child):last-child").dataset.text;this.qtyPricePairs.push([e,i])}));this.qtyPricePairs.reverse()}});
