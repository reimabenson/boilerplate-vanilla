"use strict";var __defProp=Object.defineProperty;var __defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:true,configurable:true,writable:true,value:r}):e[t]=r;var __publicField=(e,t,r)=>__defNormalProp(e,typeof t!=="symbol"?t+"":t,r);if(!customElements.get("recipient-form"))customElements.define("recipient-form",class RecipientForm extends HTMLElement{constructor(){var e,t,r;super();__publicField(this,"cartUpdateUnsubscriber");__publicField(this,"variantChangeUnsubscriber");__publicField(this,"cartErrorUnsubscriber");this.recipientFieldsLiveRegion=this.querySelector(`#Recipient-fields-live-region-${this.dataset.sectionId}`);this.checkboxInput=this.querySelector(`#Recipient-checkbox-${this.dataset.sectionId}`);this.checkboxInput.disabled=false;this.hiddenControlField=this.querySelector(`#Recipient-control-${this.dataset.sectionId}`);this.hiddenControlField.disabled=true;this.emailInput=this.querySelector(`#Recipient-email-${this.dataset.sectionId}`);this.nameInput=this.querySelector(`#Recipient-name-${this.dataset.sectionId}`);this.messageInput=this.querySelector(`#Recipient-message-${this.dataset.sectionId}`);this.sendonInput=this.querySelector(`#Recipient-send-on-${this.dataset.sectionId}`);this.offsetProperty=this.querySelector(`#Recipient-timezone-offset-${this.dataset.sectionId}`);if(this.offsetProperty)this.offsetProperty.value=(new Date).getTimezoneOffset().toString();this.errorMessageWrapper=this.querySelector(".product-form__recipient-error-message-wrapper");this.errorMessageList=(e=this.errorMessageWrapper)==null?void 0:e.querySelector("ul");this.errorMessage=(t=this.errorMessageWrapper)==null?void 0:t.querySelector(".error-message");this.defaultErrorHeader=(r=this.errorMessage)==null?void 0:r.innerText;this.currentProductVariantId=this.dataset.productVariantId;this.addEventListener("change",this.onChange.bind(this));this.onChange()}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,(e=>{if(e.source==="product-form"&&e.productVariantId.toString()===this.currentProductVariantId)this.resetRecipientForm()}));this.variantChangeUnsubscriber=subscribe(PUB_SUB_EVENTS.variantChange,(e=>{if(e.data.sectionId===this.dataset.sectionId)this.currentProductVariantId=e.data.variant.id.toString()}));this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartError,(e=>{if(e.source==="product-form"&&e.productVariantId.toString()===this.currentProductVariantId)this.displayErrorMessage(e.message,e.errors)}))}disconnectedCallback(){if(this.cartUpdateUnsubscriber)this.cartUpdateUnsubscriber();if(this.variantChangeUnsubscriber)this.variantChangeUnsubscriber();if(this.cartErrorUnsubscriber)this.cartErrorUnsubscriber()}onChange(){if(this.checkboxInput.checked){this.enableInputFields();this.recipientFieldsLiveRegion.innerText=window.accessibilityStrings.recipientFormExpanded}else{this.clearInputFields();this.disableInputFields();this.clearErrorMessage();this.recipientFieldsLiveRegion.innerText=window.accessibilityStrings.recipientFormCollapsed}}inputFields(){return[this.emailInput,this.nameInput,this.messageInput,this.sendonInput]}disableableFields(){return[...this.inputFields(),this.offsetProperty]}clearInputFields(){this.inputFields().forEach((e=>e.value=""))}enableInputFields(){this.disableableFields().forEach((e=>e.disabled=false))}disableInputFields(){this.disableableFields().forEach((e=>e.disabled=true))}displayErrorMessage(e,t){this.clearErrorMessage();this.errorMessageWrapper.hidden=false;if(typeof t==="object"){this.errorMessage.innerText=this.defaultErrorHeader;return Object.entries(t).forEach((([e,t])=>{const r=`RecipientForm-${e}-error-${this.dataset.sectionId}`;const i=`#Recipient-${e}-${this.dataset.sectionId}`;const s=`${t.join(", ")}`;const a=this.querySelector(`#${r}`);const n=a==null?void 0:a.querySelector(".error-message");if(!n)return;if(this.errorMessageList)this.errorMessageList.appendChild(this.createErrorListItem(i,s));n.innerText=`${s}.`;a.classList.remove("hidden");const o=this[`${e}Input`];if(!o)return;o.setAttribute("aria-invalid",true);o.setAttribute("aria-describedby",r)}))}this.errorMessage.innerText=t}createErrorListItem(e,t){const r=document.createElement("li");const i=document.createElement("a");i.setAttribute("href",e);i.innerText=t;r.appendChild(i);r.className="error-message";return r}clearErrorMessage(){this.errorMessageWrapper.hidden=true;if(this.errorMessageList)this.errorMessageList.innerHTML="";this.querySelectorAll(".recipient-fields .form__message").forEach((e=>{e.classList.add("hidden");const t=e.querySelector(".error-message");if(t)t.innerText=""}));[this.emailInput,this.messageInput,this.nameInput,this.sendonInput].forEach((e=>{e.setAttribute("aria-invalid",false);e.removeAttribute("aria-describedby")}))}resetRecipientForm(){if(this.checkboxInput.checked){this.checkboxInput.checked=false;this.clearInputFields();this.clearErrorMessage()}}});
