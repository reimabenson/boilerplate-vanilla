"use strict";var __defProp=Object.defineProperty;var __defNormalProp=(t,e,r)=>e in t?__defProp(t,e,{enumerable:true,configurable:true,writable:true,value:r}):t[e]=r;var __publicField=(t,e,r)=>__defNormalProp(t,typeof e!=="symbol"?e+"":e,r);class CartRemoveButton extends HTMLElement{constructor(){super();this.addEventListener("click",(t=>{t.preventDefault();const e=this.closest("cart-items")||this.closest("cart-drawer-items");e.updateQuantity(this.dataset.index,0,t)}))}}customElements.define("cart-remove-button",CartRemoveButton);class CartItems extends HTMLElement{constructor(){super();__publicField(this,"cartUpdateUnsubscriber");this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");const t=debounce((t=>{this.onChange(t)}),ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",t.bind(this))}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,(t=>{if(t.source==="cart-items")return;return this.onCartUpdate()}))}disconnectedCallback(){if(this.cartUpdateUnsubscriber)this.cartUpdateUnsubscriber()}resetQuantityInput(t){const e=this.querySelector(`#Quantity-${t}`);e.value=e.getAttribute("value");this.isEnterPressed=false}setValidity(t,e,r){t.target.setCustomValidity(r);t.target.reportValidity();this.resetQuantityInput(e);t.target.select()}validateQuantity(t){const e=parseInt(t.target.value);const r=t.target.dataset.index;let n="";if(e<t.target.dataset.min)n=window.quickOrderListStrings.min_error.replace("[min]",t.target.dataset.min);else if(e>parseInt(t.target.max))n=window.quickOrderListStrings.max_error.replace("[max]",t.target.max);else if(e%parseInt(t.target.step)!==0)n=window.quickOrderListStrings.step_error.replace("[step]",t.target.step);if(n)this.setValidity(t,r,n);else{t.target.setCustomValidity("");t.target.reportValidity();this.updateQuantity(r,e,t,document.activeElement.getAttribute("name"),t.target.dataset.quantityVariantId)}}onChange(t){this.validateQuantity(t)}onCartUpdate(){if(this.tagName==="CART-DRAWER-ITEMS")return fetch(`${routes.cart_url}?section_id=cart-drawer`).then((t=>t.text())).then((t=>{const e=(new DOMParser).parseFromString(t,"text/html");const r=["cart-drawer-items",".cart-drawer__footer"];for(const n of r){const t=document.querySelector(n);const r=e.querySelector(n);if(t&&r)t.replaceWith(r)}})).catch((t=>{console.error(t)}));else return fetch(`${routes.cart_url}?section_id=main-cart-items`).then((t=>t.text())).then((t=>{const e=(new DOMParser).parseFromString(t,"text/html");const r=e.querySelector("cart-items");this.innerHTML=r.innerHTML})).catch((t=>{console.error(t)}))}getSectionsToRender(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:document.getElementById("main-cart-footer").dataset.id,selector:".js-contents"}]}updateQuantity(t,e,r,n,a){this.enableLoading(t);const i=JSON.stringify({line:t,quantity:e,sections:this.getSectionsToRender().map((t=>t.section)),sections_url:window.location.pathname});const s=r.currentTarget instanceof CartRemoveButton?"clear":"change";fetch(`${routes.cart_change_url}`,{...fetchConfig(),body:i}).then((t=>t.text())).then((e=>{const i=JSON.parse(e);CartPerformance.measure(`${s}:paint-updated-sections"`,(()=>{const e=document.getElementById(`Quantity-${t}`)||document.getElementById(`Drawer-quantity-${t}`);const r=document.querySelectorAll(".cart-item");if(i.errors){e.value=e.getAttribute("value");this.updateLiveRegions(t,i.errors);return}this.classList.toggle("is-empty",i.item_count===0);const a=document.querySelector("cart-drawer");const s=document.getElementById("main-cart-footer");if(s)s.classList.toggle("is-empty",i.item_count===0);if(a)a.classList.toggle("is-empty",i.item_count===0);this.getSectionsToRender().forEach((t=>{const e=document.getElementById(t.id).querySelector(t.selector)||document.getElementById(t.id);e.innerHTML=this.getSectionInnerHTML(i.sections[t.section],t.selector)}));const o=i.items[t-1]?i.items[t-1].quantity:void 0;let c="";if(r.length===i.items.length&&o!==parseInt(e.value))if(typeof o==="undefined")c=window.cartStrings.error;else c=window.cartStrings.quantityError.replace("[quantity]",o);this.updateLiveRegions(t,c);const d=document.getElementById(`CartItem-${t}`)||document.getElementById(`CartDrawer-Item-${t}`);if(d&&d.querySelector(`[name="${n}"]`))a?trapFocus(a,d.querySelector(`[name="${n}"]`)):d.querySelector(`[name="${n}"]`).focus();else if(i.item_count===0&&a)trapFocus(a.querySelector(".drawer__inner-empty"),a.querySelector("a"));else if(document.querySelector(".cart-item")&&a)trapFocus(a,document.querySelector(".cart-item__name"))}));CartPerformance.measureFromEvent(`${s}:user-action`,r);publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items",cartData:i,variantId:a})})).catch((()=>{this.querySelectorAll(".loading__spinner").forEach((t=>t.classList.add("hidden")));const t=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");t.textContent=window.cartStrings.error})).finally((()=>{this.disableLoading(t)}))}updateLiveRegions(t,e){const r=document.getElementById(`Line-item-error-${t}`)||document.getElementById(`CartDrawer-LineItemError-${t}`);if(r)r.querySelector(".cart-item__error-text").textContent=e;this.lineItemStatusElement.setAttribute("aria-hidden",true);const n=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");n.setAttribute("aria-hidden",false);setTimeout((()=>{n.setAttribute("aria-hidden",true)}),1e3)}getSectionInnerHTML(t,e){return(new DOMParser).parseFromString(t,"text/html").querySelector(e).innerHTML}enableLoading(t){const e=document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems");e.classList.add("cart__items--disabled");const r=this.querySelectorAll(`#CartItem-${t} .loading__spinner`);const n=this.querySelectorAll(`#CartDrawer-Item-${t} .loading__spinner`);[...r,...n].forEach((t=>t.classList.remove("hidden")));document.activeElement.blur();this.lineItemStatusElement.setAttribute("aria-hidden",false)}disableLoading(t){const e=document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems");e.classList.remove("cart__items--disabled");const r=this.querySelectorAll(`#CartItem-${t} .loading__spinner`);const n=this.querySelectorAll(`#CartDrawer-Item-${t} .loading__spinner`);r.forEach((t=>t.classList.add("hidden")));n.forEach((t=>t.classList.add("hidden")))}}customElements.define("cart-items",CartItems);if(!customElements.get("cart-note"))customElements.define("cart-note",class CartNote extends HTMLElement{constructor(){super();this.addEventListener("input",debounce((t=>{const e=JSON.stringify({note:t.target.value});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:e}).then((()=>CartPerformance.measureFromEvent("note-update:user-action",t)))}),ON_CHANGE_DEBOUNCE_TIMER))}});
