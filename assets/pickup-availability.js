"use strict";if(!customElements.get("pickup-availability"))customElements.define("pickup-availability",class PickupAvailability extends HTMLElement{constructor(){super();if(!this.hasAttribute("available"))return;this.errorHtml=this.querySelector("template").content.firstElementChild.cloneNode(true);this.onClickRefreshList=this.onClickRefreshList.bind(this);this.fetchAvailability(this.dataset.variantId)}fetchAvailability(e){if(!e)return;let t=this.dataset.rootUrl;if(!t.endsWith("/"))t+="/";const i=`${t}variants/${e}/?section_id=pickup-availability`;fetch(i).then((e=>e.text())).then((e=>{const t=(new DOMParser).parseFromString(e,"text/html").querySelector(".shopify-section");this.renderPreview(t)})).catch((e=>{const t=this.querySelector("button");if(t)t.removeEventListener("click",this.onClickRefreshList);this.renderError()}))}onClickRefreshList(){this.fetchAvailability(this.dataset.variantId)}update(e){if(e==null?void 0:e.available)this.fetchAvailability(e.id);else{this.removeAttribute("available");this.innerHTML=""}}renderError(){this.innerHTML="";this.appendChild(this.errorHtml);this.querySelector("button").addEventListener("click",this.onClickRefreshList)}renderPreview(e){const t=document.querySelector("pickup-availability-drawer");if(t)t.remove();if(!e.querySelector("pickup-availability-preview")){this.innerHTML="";this.removeAttribute("available");return}this.innerHTML=e.querySelector("pickup-availability-preview").outerHTML;this.setAttribute("available","");document.body.appendChild(e.querySelector("pickup-availability-drawer"));const i=this.dataset.productPageColorScheme.split(" ");i.forEach((e=>{document.querySelector("pickup-availability-drawer").classList.add(e)}));const r=this.querySelector("button");if(r)r.addEventListener("click",(e=>{document.querySelector("pickup-availability-drawer").show(e.target)}))}});if(!customElements.get("pickup-availability-drawer"))customElements.define("pickup-availability-drawer",class PickupAvailabilityDrawer extends HTMLElement{constructor(){super();this.onBodyClick=this.handleBodyClick.bind(this);this.querySelector("button").addEventListener("click",(()=>{this.hide()}));this.addEventListener("keyup",(e=>{if(e.code.toUpperCase()==="ESCAPE")this.hide()}))}handleBodyClick(e){const t=e.target;if(t!=this&&!t.closest("pickup-availability-drawer")&&t.id!="ShowPickupAvailabilityDrawer")this.hide()}hide(){this.removeAttribute("open");document.body.removeEventListener("click",this.onBodyClick);document.body.classList.remove("overflow-hidden");removeTrapFocus(this.focusElement)}show(e){this.focusElement=e;this.setAttribute("open","");document.body.addEventListener("click",this.onBodyClick);document.body.classList.add("overflow-hidden");trapFocus(this)}});
